Continuing the GalaPo city directory project.

TECH: Next.js 16 App Router, TypeScript, Tailwind CSS v4, Shadcn/UI, Leaflet
EXISTING: All category pages and listing detail built.

Build the dedicated search page and enhance the global search functionality.

REQUIREMENTS:

1. SEARCH PAGE — /app/(public)/olongapo/search/page.tsx:
   
   URL examples:
   - /olongapo/search?q=restaurant
   - /olongapo/search?q=seafood&barangay=barretto
   - /olongapo/search?q=clinic&category=health-wellness
   
   LAYOUT:
   
   TOP SECTION:
   - Prominent search bar (same SearchBar component from homepage but expanded)
   - Shows current search query in the input field
   - Category dropdown pre-selected if filtered
   - Barangay dropdown pre-selected if filtered
   - Search button to re-search
   - Below search bar: "Results for '[query]'" or "All businesses in Olongapo"
   - Results count: "Found X businesses"
   
   FILTER BAR (horizontal, below search):
   - Category pill filter (horizontal scrollable chips of parent categories)
   - Clicking a category chip filters results AND highlights the chip
   - "All Categories" chip to reset
   - Barangay dropdown (multi-select)
   - "Open Now" toggle button
   - Sort dropdown: "Most Relevant" | "Featured First" | "Newest" | "Name A-Z"
   - View toggle: Grid | List | Map (icons)
   - "Clear All" text button
   - Active filters shown as removable chips below filter bar
   
   RESULTS AREA:
   
   GRID VIEW (default):
   - Same as category page grid
   - Sponsored results marked with "Sponsored" badge at top
   - Featured/Premium results next
   - Regular results
   - Inline ad slot after every 5th result
   - Pagination at bottom
   
   LIST VIEW:
   - Horizontal full-width cards
   - More info visible: hours, description, category, distance (if geolocation)
   
   MAP VIEW (split layout):
   - LEFT: Full-height map (60% width on desktop)
     - All result pins on map
     - Cluster markers when zoomed out (use Leaflet MarkerCluster)
     - Different pin colors: Gold for sponsored, Orange for featured, Blue for regular
     - Click pin → info popup
     - Map bounds auto-fit to show all results
     - "Search this area" button appears when user pans/zooms map
   - RIGHT: Scrollable results list (40% width)
     - Hovering a list item highlights the corresponding map pin
     - Clicking a list item centers map on that pin
   - MOBILE: Map full-width on top (300px), list below
     - Toggle between map and list with tab buttons
   
   NO RESULTS STATE:
   - Friendly illustration
   - "No businesses found for '[query]'"
   - Suggestions:
     - "Try different keywords"
     - "Remove some filters"
     - "Browse all categories" (link)
   - Show "Popular categories" grid as fallback content

2. ENHANCE SearchBar COMPONENT (/components/shared/SearchBar.tsx):
   - When used on homepage: larger, with gradient background context
   - When used on search page: compact, white background
   - Accept prop: variant="hero" | "compact"
   - Form action navigates to /olongapo/search?q=[input]&category=[selected]&barangay=[selected]
   - Pressing Enter submits search
   - Mobile: inputs stack vertically in "hero" variant

3. SEARCH URL STATE MANAGEMENT:
   - ALL filters stored in URL search params (shareable URLs)
   - Create custom hook: useSearchFilters()
     - Reads all filter values from URL params
     - Provides setter functions that update URL params
     - Handles multi-value params (barangay=barretto,kalaklan)
     - Returns typed filter object
     - Debounces URL updates for rapid filter changes
   
4. CREATE COMPONENTS:
   - /components/public/search/SearchPage.tsx — main search page content
   - /components/public/search/FilterBar.tsx — horizontal filter chips + dropdowns
   - /components/public/search/CategoryChips.tsx — scrollable category filter chips
   - /components/public/search/ActiveFilters.tsx — removable filter chip display
   - /components/public/search/SplitMapView.tsx — side-by-side map + list for search
   - /components/public/search/NoResults.tsx — no results state with suggestions
   - /components/public/search/SearchResultsHeader.tsx — query, count, sort, view toggle
   
5. GEOLOCATION (optional enhancement):
   - If user grants location permission:
     - Show "Near Me" button in filter bar
     - Sort by distance becomes available
     - Each listing card shows distance in km
     - Map centers on user location with radius circle
   - If user denies → "Near Me" button hidden, no distance shown
   - Use browser Geolocation API
   - Create hook: useGeolocation() — returns { lat, lng, loading, error, requestPermission }
   - Distance calculation: Haversine formula in /lib/geo.ts
     - calculateDistance(lat1, lng1, lat2, lng2): returns km
     - formatDistance(km): returns "0.5 km" or "2.3 km"

6. HEADER SEARCH (global):
   - Add a compact search icon button to the header (right side, before "List Your Business")
   - Click → expands to a search input field (animated slide-in)
   - Pressing Enter → navigates to /olongapo/search?q=[input]
   - On search page, this header search is hidden (page has its own search bar)

7. SEO:
   - generateMetadata() with:
     - title: "Search [query] in Olongapo City | GalaPo" (or "Search Businesses in Olongapo City | GalaPo" if no query)
     - description: "Find [query] businesses in Olongapo City. Browse verified listings with contact info, hours, and directions."
     - noindex for filtered/paginated results (prevent thin content indexing)
     - But DO index the base search page and popular category search pages

8. PERFORMANCE:
   - Debounce search input (300ms) if doing live search
   - Use React.memo on listing cards (prevent unnecessary re-renders)
   - Lazy load map component (only load when map view selected)
   - Virtualize long result lists if > 50 items visible (optional, use tanstack-virtual)
   - Image lazy loading on all listing card images

Output ALL files with complete code. Include the Leaflet MarkerCluster setup with dynamic import.