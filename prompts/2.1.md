I am building a city business directory called "GalaPo". Generate the COMPLETE Supabase PostgreSQL schema.

This SQL will be run in the Supabase SQL Editor. Include everything in ONE script.

REQUIREMENTS:

1. Enable necessary extensions:
   - uuid-ossp (for UUID generation)
   - pg_trgm (for fuzzy text search)

2. Create ENUM types:
   - user_role: super_admin, business_owner
   - listing_status: pending, approved, rejected, claimed_pending
   - plan_type: free, featured, premium
   - subscription_status: active, expired, pending_payment, cancelled
   - payment_status: pending, verified, rejected
   - payment_method: gcash, bank_transfer
   - field_type: text, textarea, number, currency, boolean, select, multi_select, url, phone, email, image_gallery, menu_items, time_range, json
   - placement_location: homepage_banner, search_sidebar, search_inline, listing_banner, listing_sidebar, category_banner, blog_inline, blog_sidebar
   - annual_check_status: pending, confirmed, no_response, deactivated
   - notification_type: listing_approved, listing_rejected, claim_approved, claim_rejected, subscription_expiring, premium_expiring, annual_check, annual_check_warning, listing_deactivated, payment_confirmed, payment_rejected, new_listing_submitted, new_claim_request, new_payment_uploaded, annual_check_flagged, annual_check_no_response

3. Create tables:

   PROFILES (extends Supabase auth.users):
   - id (UUID, FK to auth.users)
   - email
   - full_name
   - phone
   - role (user_role, default 'business_owner')
   - avatar_url
   - is_active (default true)
   - created_at, updated_at

   CITIES:
   - id (UUID)
   - name (e.g., "Olongapo City")
   - slug (e.g., "olongapo") UNIQUE
   - province
   - region
   - is_active (default true)
   - created_at

   BARANGAYS (dynamic, managed by admin):
   - id (UUID)
   - city_id (FK)
   - name
   - slug UNIQUE per city
   - is_active (default true)
   - sort_order

   CATEGORIES:
   - id (UUID)
   - name
   - slug UNIQUE
   - description
   - icon (string, for icon name)
   - parent_id (FK self-referencing, NULL for parent categories)
   - sort_order (integer)
   - is_active (default true)
   - created_at

   CATEGORY_FIELDS (dynamic fields per category):
   - id (UUID)
   - category_id (FK) — this references the PARENT category
   - subcategory_id (FK, nullable) — if field is specific to a subcategory
   - field_name (snake_case identifier)
   - field_label (display label)
   - field_type (field_type enum)
   - is_required (default false)
   - placeholder
   - help_text
   - options (JSONB, for select/multi_select options)
   - validation_rules (JSONB, e.g., {min: 0, max: 100})
   - sort_order
   - is_active (default true)

   LISTINGS:
   - id (UUID)
   - owner_id (FK to profiles, nullable for pre-populated)
   - city_id (FK)
   - barangay_id (FK)
   - category_id (FK)
   - subcategory_id (FK, nullable)
   - business_name
   - slug UNIQUE
   - address (street address text)
   - lat (decimal)
   - lng (decimal)
   - phone (text)
   - phone_secondary (text, nullable)
   - email (text, nullable)
   - website (text, nullable)
   - social_links (JSONB: {facebook, instagram, tiktok})
   - operating_hours (JSONB: {monday: {open, close, is_closed}, ...})
   - short_description (VARCHAR 160)
   - full_description (TEXT)
   - tags (TEXT array)
   - payment_methods (TEXT array)
   - logo_url
   - status (listing_status, default 'pending')
   - is_active (default true)
   - is_featured (default false)
   - is_premium (default false)
   - is_pre_populated (default false) — flag for admin-added listings
   - claim_proof_url (text, nullable)
   - claimed_at (timestamp, nullable)
   - rejection_reason (text, nullable)
   - last_verified_at (timestamp, default now)
   - created_at, updated_at

   LISTING_IMAGES:
   - id (UUID)
   - listing_id (FK)
   - image_url
   - alt_text
   - sort_order
   - is_primary (default false)
   - created_at

   LISTING_FIELD_VALUES:
   - id (UUID)
   - listing_id (FK)
   - field_id (FK to category_fields)
   - value (JSONB — stores any type of value)
   - created_at, updated_at
   - UNIQUE constraint on (listing_id, field_id)

   DEALS:
   - id (UUID)
   - listing_id (FK)
   - title
   - description
   - image_url (nullable)
   - discount_text (e.g., "20% OFF", "Buy 1 Get 1")
   - start_date
   - end_date
   - is_active (default true)
   - created_at

   EVENTS:
   - id (UUID)
   - listing_id (FK, nullable — null for city-wide events)
   - title
   - slug UNIQUE
   - description (TEXT)
   - image_url
   - event_date (DATE)
   - start_time (TIME)
   - end_time (TIME, nullable)
   - venue (text)
   - venue_address (text)
   - is_city_wide (default false)
   - is_featured (default false) — for premium/ad placement
   - created_by (FK to profiles)
   - is_active (default true)
   - created_at, updated_at

   BLOG_POSTS:
   - id (UUID)
   - title
   - slug UNIQUE
   - content (TEXT — rich text/markdown)
   - excerpt (VARCHAR 300)
   - featured_image_url
   - tags (TEXT array)
   - linked_listing_ids (UUID array — references listings mentioned)
   - is_published (default false)
   - meta_title (VARCHAR 70)
   - meta_description (VARCHAR 160)
   - author_id (FK to profiles)
   - published_at (timestamp)
   - created_at, updated_at

   SUBSCRIPTIONS:
   - id (UUID)
   - listing_id (FK)
   - plan_type (plan_type enum)
   - status (subscription_status)
   - start_date
   - end_date
   - amount (DECIMAL 10,2)
   - auto_renew (default false)
   - created_at, updated_at

   PAYMENTS:
   - id (UUID)
   - subscription_id (FK, nullable)
   - listing_id (FK)
   - user_id (FK to profiles)
   - amount (DECIMAL 10,2)
   - payment_method (payment_method enum)
   - payment_proof_url (text)
   - reference_number (text, nullable)
   - description (text — what they're paying for)
   - status (payment_status, default 'pending')
   - verified_by (FK to profiles, nullable)
   - verified_at (timestamp, nullable)
   - rejection_reason (text, nullable)
   - created_at

   INVOICES:
   - id (UUID)
   - payment_id (FK)
   - listing_id (FK)
   - user_id (FK to profiles)
   - invoice_number (VARCHAR, UNIQUE)
   - amount (DECIMAL 10,2)
   - description (text)
   - items (JSONB — line items array)
   - issued_at (timestamp, default now)
   - due_date (date)
   - status (VARCHAR: draft, issued, paid)
   - created_at

   AD_PLACEMENTS:
   - id (UUID)
   - title
   - image_url
   - target_url
   - placement_location (placement_location enum)
   - listing_id (FK, nullable — if ad is for a specific business)
   - advertiser_id (FK to profiles, nullable)
   - start_date (date)
   - end_date (date)
   - impressions (integer, default 0)
   - clicks (integer, default 0)
   - is_active (default true)
   - is_adsense (default false) — true means render AdSense in this slot
   - adsense_slot_id (text, nullable)
   - cost (DECIMAL 10,2, nullable)
   - payment_id (FK, nullable)
   - created_at, updated_at

   NOTIFICATIONS:
   - id (UUID)
   - user_id (FK to profiles)
   - type (notification_type)
   - title
   - message (TEXT)
   - is_read (default false)
   - data (JSONB — extra context like listing_id, etc.)
   - created_at

   STATIC_PAGES:
   - id (UUID)
   - title
   - slug UNIQUE
   - content (TEXT — rich text)
   - meta_title
   - meta_description
   - is_published (default true)
   - sort_order
   - created_at, updated_at

   SITE_SETTINGS:
   - id (UUID)
   - key (VARCHAR UNIQUE)
   - value (JSONB)
   - description (text)
   - updated_at

   ANNUAL_CHECKS:
   - id (UUID)
   - listing_id (FK)
   - check_date (date — when the check was triggered)
   - response_deadline (date — check_date + 7 days)
   - status (annual_check_status, default 'pending')
   - responded_at (timestamp, nullable)
   - deactivated_at (timestamp, nullable)
   - created_at

   REACTIVATION_FEES:
   - id (UUID)
   - listing_id (FK)
   - amount (DECIMAL 10,2)
   - payment_id (FK, nullable)
   - status (VARCHAR: pending, paid, waived)
   - created_at

   TOP_SEARCH_PLACEMENTS (for paid "top in category" feature):
   - id (UUID)
   - listing_id (FK)
   - category_id (FK)
   - subcategory_id (FK, nullable)
   - start_date
   - end_date
   - position (integer — 1, 2, 3 for top spots)
   - payment_id (FK)
   - is_active (default true)
   - created_at

   CSV_IMPORT_LOGS:
   - id (UUID)
   - file_name
   - category_id (FK)
   - subcategory_id (FK, nullable)
   - total_rows (integer)
   - successful_rows (integer)
   - failed_rows (integer)
   - error_log (JSONB)
   - imported_by (FK to profiles)
   - created_at

4. Create INDEXES for performance:
   - listings: slug, city_id, category_id, subcategory_id, barangay_id, status, is_active, is_featured, is_premium
   - listings: GIN index on tags for array search
   - listings: GIN index on business_name using pg_trgm for fuzzy search
   - categories: slug, parent_id
   - events: event_date, is_active
   - deals: end_date, is_active
   - blog_posts: slug, is_published
   - subscriptions: listing_id, status, end_date
   - notifications: user_id, is_read
   - ad_placements: placement_location, is_active, start_date, end_date
   - annual_checks: listing_id, status

5. Create ROW LEVEL SECURITY (RLS) policies:
   - PROFILES: Users can read/update their own profile. Super admin can read/update all.
   - LISTINGS: Anyone can read approved+active listings. Business owners can CRUD their own. Super admin can CRUD all.
   - LISTING_IMAGES: Same as listings.
   - LISTING_FIELD_VALUES: Same as listings.
   - CATEGORIES: Anyone can read active. Super admin can CRUD.
   - BARANGAYS: Anyone can read active. Super admin can CRUD.
   - DEALS: Anyone can read active deals of approved listings. Business owner can CRUD their own. Super admin can CRUD all.
   - EVENTS: Anyone can read active events. Business owner can CRUD their own. Super admin can CRUD all.
   - BLOG_POSTS: Anyone can read published. Super admin can CRUD.
   - SUBSCRIPTIONS: Business owner can read their own. Super admin can CRUD all.
   - PAYMENTS: Business owner can read/create their own. Super admin can read/update all.
   - INVOICES: Business owner can read their own. Super admin can CRUD all.
   - AD_PLACEMENTS: Anyone can read active ads (for display). Super admin can CRUD all.
   - NOTIFICATIONS: Users can read/update their own. Super admin can create for anyone.
   - STATIC_PAGES: Anyone can read published. Super admin can CRUD.
   - SITE_SETTINGS: Anyone can read. Super admin can update.
   - ANNUAL_CHECKS: Business owner can read/update their own. Super admin can CRUD all.
   - TOP_SEARCH_PLACEMENTS: Anyone can read active. Super admin can CRUD.

6. Create FUNCTIONS and TRIGGERS:
   - Auto-update updated_at timestamp on row update (for all tables that have it)
   - Function to auto-create profile when auth.users signs up (trigger on auth.users insert)
   - Function to increment ad impressions
   - Function to increment ad clicks

7. Seed initial data:
   - Insert city: Olongapo City (slug: olongapo, province: Zambales, region: Central Luzon)
   - Insert a super admin profile (email configurable)
   - Insert default site settings:
     - site_name: "GalaPo"
     - site_tagline: "Discover Olongapo"
     - contact_email: (placeholder)
     - gcash_number: (placeholder)
     - bank_details: (placeholder JSON)
     - reactivation_fee_amount: 500
     - featured_listing_monthly_price: 299
     - premium_listing_monthly_price: 599
     - top_search_monthly_price: 999
     - ad_placement_monthly_price: 1499
     - subscription_expiry_warning_days: 7
     - annual_check_response_days: 7
   - Insert default static pages: About Us, Contact Us, Terms & Conditions, Privacy Policy, FAQ, Advertise With Us
   - Insert the COMPLETE category and subcategory structure from this list:

   [Include the ENTIRE category tree I defined earlier with all parent categories and subcategories. Each parent gets a slug and icon name. Each subcategory references its parent_id.]

Output the complete SQL script ready to paste into Supabase SQL Editor.