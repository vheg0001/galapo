Continuing the GalaPo project. Build the backend API routes for the homepage data.

TECH: Next.js 16 Route Handlers, Supabase, TypeScript

REQUIREMENTS:

1. /app/api/listings/featured/route.ts:
   - GET: Fetch featured listings (is_featured = true, is_active = true, status = 'approved')
   - Order by: is_premium DESC, created_at DESC
   - Limit: query param (default 10)
   - Include: primary image, category name, barangay name
   - Cache: use Next.js 16 caching (revalidate every 5 minutes)

2. /app/api/listings/latest/route.ts:
   - GET: Fetch latest approved active listings
   - Order by: created_at DESC
   - Limit: query param (default 6)
   - Include: primary image, category name, barangay name

3. /app/api/categories/route.ts:
   - GET: Fetch all active categories with their subcategories
   - Include: listing count per category (only approved + active)
   - Structure: nested (parent with children array)
   - Cache: revalidate every 30 minutes
   - Query params: ?parent_only=true (for mega menu, only parents)

4. /app/api/events/upcoming/route.ts:
   - GET: Fetch upcoming events (event_date >= today, is_active = true)
   - Order by: event_date ASC
   - Limit: query param (default 4)
   - Include: listing business_name if tied to a business

5. /app/api/deals/active/route.ts:
   - GET: Fetch active deals (end_date >= today, is_active = true, linked listing must be approved + active)
   - Order by: end_date ASC (expiring soon first)
   - Limit: query param (default 8)
   - Include: listing business_name, category

6. /app/api/blog/latest/route.ts:
   - GET: Fetch latest published blog posts
   - Order by: published_at DESC
   - Limit: query param (default 3)

7. /app/api/ads/route.ts:
   - GET: Fetch active ads for a given placement location
   - Query param: ?location=homepage_banner&position=1
   - Only return ads where start_date <= today AND end_date >= today AND is_active = true
   - If is_adsense = true, return the adsense_slot_id instead of image
   - Track impression (increment impressions count)

8. /app/api/ads/click/route.ts:
   - POST: Record ad click { ad_id }
   - Increment clicks count for the given ad

9. /app/api/barangays/route.ts:
   - GET: Fetch all active barangays for a given city
   - Query param: ?city=olongapo
   - Order by: sort_order, name
   - Cache: revalidate every 1 hour

10. /app/api/settings/public/route.ts:
    - GET: Fetch public site settings (site_name, tagline, contact info, social links, gcash number for payments)
    - Exclude sensitive settings
    - Cache: revalidate every 1 hour

11. Create /lib/api-helpers.ts:
    - successResponse(data, status = 200)
    - errorResponse(message, status = 400)
    - paginatedResponse(data, total, page, limit)
    - getCurrentUser(request) — extract user from Supabase auth header
    - requireAuth(request) — throw 401 if not authenticated
    - requireAdmin(request) — throw 403 if not super_admin role

12. Create /lib/queries.ts:
    - Reusable Supabase query builders:
      - getListingsQuery(filters) — builds filtered listing query
      - getCategoriesWithCount()
      - getActiveAdsForLocation(location)
    - These will be reused across multiple routes

Output all API route files and helper files with complete code. Use proper error handling and TypeScript types.